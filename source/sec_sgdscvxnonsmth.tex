% !TEX ROOT=./main.tex

In this section, we prove the convergence rate of stochastic for strongly convex
non-smooth problem.


\begin{theorem}
	Let assumption~\ref{ass:stroncvx} and assumption~\ref{ass:subgrad2} hold, choose learning rate $\eta_t = \frac{2}{\mu(t+1)} $.Then,
	\begin{align}
		\EE[F(\hat{\vw}_T)] - F^* \leq \frac{2(B + C)}{\mu(T+1)}.
	\end{align}
	where $B =  G^2 (3  + 8 (E-1)^2)$, for sampling scheme I $C =\frac{4(N - K)}{K(N-1)} \eta_t^2 E^2G^2 $ or
sampling scheme II $C = \frac{4}{K} \eta_t^2 E^2G^2$, for full device participation $C= 0$.
\end{theorem}


\begin{proof}

\textbf{Full Device activation: }  $\ov{w}_{t+1} = \ov{v}_{t+1}, \forall t$ 
\begin{align}
\Delta_{t+1} = \EE\left[\left\|\bar{\vv}_{t+1}-\vw^{*}\right\|^2| \vw_{t}\right]=\|\bar{\vw}_{t}-\vw^{*}\|^{2} \underbrace{ - 2 \eta_{t} \EE \vg_{t}^{\top}\left(\bar{\vw}_{t}-\vw^{*}\right)}_{B_1} + \eta_{t}^{2} \EE\| \vg_{t} \|^{2}	
\label{eq:expand2}
\end{align}


Now we focus on bounding $B_1$ in \eq{\ref{eq:expand}}: 
\begin{align}
	& -2 \eta_{t} \left<\EE \vg_{t}, \bar{\vw}_{t}-\vw^{*} \right>\\
  = & 2 \eta_{t} \sum_{k=1}^N p_k \left(-\left<\EE \vg_{t,k}, \bar{\vw}_{t}-\vw_t^k + \vw_t^k - \vw^{*} \right> \right) \\
  \leq& 2 \eta_{t} \sum_{k=1}^N p_k  \left(\frac{1}{2\eta_t} \|\overline{\vw}_t - \vw_t^k\|^2 + \frac{\eta_t}{2} \|\EE \vg_{t,k}\|^2 - F_k(\vw_t^k) - F_k(\vw^*) - \frac{\mu}{2} \|\vw_t^k - \vw^*\|^2 \right) \\
  =& \sum_{k=1}^N p_k \|\overline{\vw}_t - \vw_t^k\|^2 +  \sum_{k=1}^N p_k \eta_t^2 \|\EE \vg_{t,k}\|^2 
  - 2\eta_t\sum_{k=1}^N p_k (F_k(\vw_t^k) - F^*) - \eta_t \mu \sum_{k=1}^N p_k \|\vw_t^k - \vw^*\|^2 \\
  \leq & \sum_{k=1}^N p_k \|\overline{\vw}_t - \vw_t^k\|^2 +  \sum_{k=1}^N p_k \eta_t^2 \|\EE \vg_{t,k}\|^2 
  - 2\eta_t\sum_{k=1}^N p_k (F_k(\vw_t^k) - F^*) - \eta_t \mu \|\ov{w}_t- \vw^*\|^2  \label{eq:scvxnsmth1}
\end{align}
where in the third line we use Cauchy-Schwarz inequality, AM-GM inequality and strong convexity.
In the last line we use convexity of l2 norm and Jensen's inequality.

Now we plug in $B_1$ into \eq{\ref{eq:expand2}}, we have,
\begin{align}
	\EE\left\|\bar{\vv}_{t+1}-\vw^{*}\right\|^2 & \leq (1 - \eta_t\mu)\|\bar{\vw}_{t}-\vw^{*}\|^{2} + \eta_{t}^{2} \EE\| \vg_{t} \|^{2} +  \sum_{k=1}^N p_k \eta_t^2 \|\EE \vg_{t,k}\|^2 \\
	& \underbrace{-2\eta_t\sum_{k=1}^N p_k (F_k(\vw_t^k) - F^*)}_{C_1} + \sum_{k=1}^N p_k \|\overline{\vw}_t - \vw_t^k\|^2 \label{eq:scvxnsmth2}
\end{align}

Now we bound $C_1$
\begin{align}
	-2\eta_t\sum_{k=1}^N p_k (F_k(\vw_t^k) - F^*) & = -2\eta_t\sum_{k=1}^N p_k \left(F_k(\vw_t^k) - F_k(\ov{w}_t)\right) + F(\ov{w}_t) -  F^*\\
& \leq \sum_{k=1}^{k} p_{k}[\eta_{t}^{2}\|\EE \vg_{t,k}(\ov{w}_{t})\|^{2}+\| \vw_{t}^{k}-\ov{w}_t^{k} \|^{2}]-2 \eta_{t}(F(\ov{w}_{t})- F^{*}). 
\end{align}

Plug in $C_1$ into \eq{\ref{eq:scvxnsmth2}}:
\begin{align}
	\EE\left\|\bar{\vv}_{t+1}-\vw^{*}\right\|^2 \leq
	&  (1 - \eta_t\mu)\|\bar{\vw}_{t}-\vw^{*}\|^{2} + \eta_{t}^{2} \EE\| \vg_{t} \|^{2} +  \sum_{k=1}^N p_k \eta_t^2 \|\EE \vg_{t,k}\|^2 \\& + \sum_{k=1}^{k} p_{k}\eta_{t}^{2}\|\EE \vg_{t,k}(\ov{w}_{t})\|^{2}-2 \eta_{t}(F(\ov{w}_{t})- F^{*})  + 2 \underbrace{\sum_{k=1}^N p_k \|\overline{\vw}_t - \vw_t^k\|^2}_{C_2} \label{eq:scvxnsmth3}
\end{align}
$C_2 \leq  4\eta_t^2 (E-1)^2 G^2$ can be bounded by Lemma 3 in \cite{li2019convergence}, we plug in $C_2$ into \eq{\ref{eq:scvxnsmth3}},


\begin{align}
	\underbrace{\EE\left\|\bar{\vv}_{t+1}-\vw^{*}\right\|^2}_{\Delta_{t+1}} \leq &  (1 - \eta_t\mu)\|\bar{\vw}_{t}-\vw^{*}\|^{2} -2 \eta_{t}(F(\ov{w}_{t})- F^{*})\\
	+ & \underbrace{\eta_{t}^{2} \EE\| \vg_{t} \|^{2} +  \sum_{k=1}^N p_k \eta_t^2 \|\EE \vg_{t,k}\|^2  + \sum_{k=1}^{k} p_{k}\eta_{t}^{2}\|\EE \vg_{t,k}(\ov{w}_{t})\|^{2} + 8\eta_t^2 (E-1)^2 G^2}_{\eta_t^2 B} \label{eq:scvxnsmth4} \\
	\Delta_{t+1}  \leq &  (1 - \eta_t\mu) \Delta_t + \eta^2_t B - 2 \eta_t [F(\ov{w}_{t})- F^{*}] \label{eq:scvxnsmth5}
\end{align}
where 
\begin{align*}
\eta_t^2 B &= \eta_{t}^{2} \EE\| \vg_{t} \|^{2} +  \sum_{k=1}^N p_k \eta_t^2 \|\EE \vg_{t,k}\|^2  + \sum_{k=1}^{k} p_{k}\eta_{t}^{2}\|\EE \vg_{t,k}(\ov{w}_{t})\|^{2} + 8\eta_t^2 (E-1)^2 G^2 \\
& \leq \eta_t^2 G^2 (3  + 8 (E-1)^2) 	
\end{align*}

Rearrange, set $\eta_t = \frac{2}{\mu(t+1)} $, using the weighted average trick in \cite{lacoste2012simpler}, and sum two sides of \eq{\ref{eq:scvxnsmth5}}, we have
\begin{align}
F\left(\ov{w}_{t}\right)-F^{*} &\leqslant \left(\frac{1}{2 \eta_{t}}-\frac{\mu}{2}\right) \Delta t-\frac{\Delta_{t+1}}{2 \eta_{t}}+\frac{\eta_{t}}{2} B\\
t(F\left(\ov{w}_{t}\right)-F^{*}) & \leqslant t\left(\frac{1}{2 \eta_{t}}-\frac{\mu}{2}\right) \Delta t-\frac{t\Delta_{t+1}}{2 \eta_{t}}+\frac{\eta_{t}}{2} Bt\\
t(F\left(\ov{w}_{t}\right)-F^{*}) & \leqslant \frac{\mu t(t-1)}{4} \Delta t- \frac{\mu t(t+1)\Delta_{t+1}}{4}+\frac{t}{\mu(t+1)} B\\
t(F\left(\ov{w}_{t}\right)-F^{*}) & \leqslant \frac{\mu t(t-1)}{4} \Delta t- \frac{\mu t(t+1)\Delta_{t+1}}{4}+\frac{B}{\mu}\\
\sum_{t=1}^T \frac{2t}{T(T+1)}F\left(\ov{w}_{t}\right)-F^{*} & \leqslant \frac{2B}{\mu(T+1)} \\
F\left(\sum_{t=1}^T \frac{2t}{T(T+1)} \ov{w}_{t}\right)-F^{*} & \leqslant \frac{2B}{\mu(T+1)} 
\end{align}

\textbf{Partial Device activation: }

If $t + 1 \notin \cI_{E}$, $\ov{w}_{t+1} = \ov{v}_{t+1}$, 
\begin{align}
\EE\left[\left\|\ov{w}_{t+1}-\vw^{*}\right\|^2| \ov{w}_{t}\right] = \EE\left[\left\|\bar{\vv}_{t+1}-\vw^{*}\right\|^2| \vw_{t}\right]=\|\bar{\vw}_{t}-\vw^{*}\|^{2} \underbrace{ - 2 \eta_{t} \EE \vg_{t}^{\top}\left(\bar{\vw}_{t}-\vw^{*}\right)}_{B_1} + \eta_{t}^{2} \EE\| \vg_{t} \|^{2}	
\label{eq:expandp1}
\end{align}

If $t + 1 \in \cI_{E}$, $\ov{w}_{t+1} = \frac{1}{K}\sum_{l=1}^K \vv_{t+1}^{i_l}$, 
\begin{align}
\EE\left\|\ov{w}_{t+1}-\vw^{*}\right\|^2 & =  \EE\left\|\ov{w}_{t+1} - \ov{v}_{t+1} + \ov{v}_{t+1} -\vw^{*}\right\|^2 \\
& \leq \EE\left\|\ov{w}_{t+1} - \ov{v}_{t+1}\right\|^2 + \EE \left\| \ov{v}_{t+1} -\vw^{*}\right\|^2 \\
&= \|\bar{\vw}_{t}-\vw^{*}\|^{2} \underbrace{ - 2 \eta_{t} \EE \vg_{t}^{\top}\left(\bar{\vw}_{t}-\vw^{*}\right)}_{B_1} + \eta_{t}^{2} \EE\| \vg_{t} \|^{2}	+ \EE\left\|\ov{w}_{t+1} - \ov{v}_{t+1}\right\|^2
\label{eq:expandp2}
\end{align}


Similar to the full device derivation:
\begin{align}
F\left(\sum_{t=1}^T \frac{2t}{T(T+1)} \ov{w}_{t}\right)-F^{*} & \leqslant \frac{2(B + C)}{\mu(T+1)} 	
\end{align}
where $B =  G^2 (3  + 8 (E-1)^2)$ and $C =\frac{4(N - K)}{K(N-1)} \eta_t^2 E^2G^2 $ or
$C = \frac{4}{K} \eta_t^2 E^2G^2$ depends on the sampling scheme.



\end{proof}